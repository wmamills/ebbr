sudo: false
dist: focal
cache:
  apt: true
env:
  global:
  - SPHINXBUILD=~/.local/bin/sphinx-build
git:
  depth: false
addons:
  apt:
    packages:
    - python3-pip
    - latexmk
    - libalgorithm-diff-perl
    - texlive
    - texlive-latex-extra
    - texlive-humanities
install:
- pip3 install --user mako
- pip3 install --user typing
- pip3 install --user Sphinx==2.4.4
script:
- make latexpdf
- make html
- make singlehtml
before_deploy:
- cp build/latex/ebbr.pdf build/ebbr-$TRAVIS_TAG.pdf
deploy:
- provider: releases
  prerelease: true
  file_glob: true
  file:
  - build/ebbr-*.pdf
  skip_cleanup: true
  on:
    tags: true
    branch: upstream
    repo: glikely/ebbr
- provider: pages
  github_token: "$GITHUB_TOKEN"
  local_dir: build/singlehtml
  skip_cleanup: true
  on:
    branch: master
- provider: pages
  github_token: "$GITHUB_TOKEN"
  local_dir: build/singlehtml
  skip_cleanup: true
  repo: arm-software/ebbr
  on:
    branch: upstream
